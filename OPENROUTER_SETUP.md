# Настройка OpenRouter для AI-функций

## Получение API ключа

1. Перейдите на [OpenRouter.ai](https://openrouter.ai/)
2. Зарегистрируйтесь или войдите в аккаунт
3. Перейдите в раздел "Keys" в вашем профиле
4. Создайте новый API ключ
5. Скопируйте ключ

## Настройка переменных окружения

### Для разработки (локально)

Создайте файл `.env` в корне проекта:

```env
OPENROUTER_API_KEY=your_openrouter_api_key_here
ROSREESTR_API_KEY=your_rosreestr_api_key_here
```

### Для продакшена (Docker)

Обновите `docker-compose.yml`:

```yaml
environment:
  OPENROUTER_API_KEY: "your_openrouter_api_key_here"
  ROSREESTR_API_KEY: "your_rosreestr_api_key_here"
```

## Используемая модель

- **Модель**: `tngtech/deepseek-r1t2-chimera:free`
- **Тип**: Бесплатная модель для тестирования
- **Ограничения**: 
  - Лимит запросов: 10,000 в месяц
  - Максимум токенов: 2,048 на запрос
  - Скорость: до 10 запросов в минуту

## Функции AI

### 1. AI-Помощник
- Отвечает на вопросы о туризме в Ростове-на-Дону
- Предлагает персональные рекомендации
- Помогает с планированием поездок

### 2. AI-Планировщик маршрутов
- Создает персональные маршруты
- Учитывает интересы пользователя
- Адаптируется под бюджет и время
- Предлагает несколько вариантов

## API Endpoints

### AI-Помощник
```
POST /api/ai/chat
{
  "message": "Что посмотреть в Ростове?",
  "context": {
    "location": "Ростов-на-Дону",
    "interests": ["культура", "история"]
  }
}
```

### AI-Маршруты
```
POST /api/ai/create-route
{
  "startLocation": {
    "latitude": 47.2354,
    "longitude": 39.7015
  },
  "interests": ["культура", "еда"],
  "duration": 4,
  "budget": 2000,
  "transportMode": "walking"
}
```

## Обработка ошибок

Система имеет fallback механизм:
1. Если OpenRouter недоступен - используется локальная генерация
2. Если API ключ не настроен - показывается предупреждение
3. При ошибках парсинга JSON - используется резервный алгоритм

## Мониторинг использования

- Логи запросов к OpenRouter сохраняются в консоли
- Ошибки API записываются в лог файлы
- Статистика использования доступна в OpenRouter dashboard

## Безопасность

- API ключи хранятся в переменных окружения
- Запросы к OpenRouter идут через HTTPS
- Пользовательские данные не передаются в OpenRouter
- Контекст ограничен только необходимыми данными

## Обновление модели

Для смены модели измените в `back/controllers/ai-controller.js`:

```javascript
this.model = 'tngtech/deepseek-r1t2-chimera:free';
```

На нужную модель из [списка доступных](https://openrouter.ai/models).
